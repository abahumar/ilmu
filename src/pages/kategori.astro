---
import BaseLayout from '../layouts/BaseLayout.astro';
import { videos } from '../data/videos';
---

<BaseLayout title="Kategori | ilmu.my">
  <section class="section-head">
    <h1 id="categoryTitle">Kategori</h1>
  </section>
  <div id="categoryVideos" class="video-grid"></div>

  <script id="videos-data" type="application/json" set:html={JSON.stringify(videos)}></script>
  <script type="module">
    const safeText = (value) => String(value ?? '').replace(/[<>]/g, '');
    const videoThumb = (videoId) => `https://i.ytimg.com/vi/${encodeURIComponent(videoId)}/hqdefault.jpg`;
    const videoCardHtml = (video) => `
      <article class="card">
        <a href="/tonton?v=${encodeURIComponent(video.id)}" aria-label="Tonton ${safeText(video.title)}">
          <img class="thumb" src="${videoThumb(video.id)}" alt="Thumbnail ${safeText(video.title)}" loading="lazy" onerror="this.onerror=null;this.src='/thumb-fallback.svg'" />
        </a>
        <div class="video-card-content">
          <h3 class="video-title"><a href="/tonton?v=${encodeURIComponent(video.id)}">${safeText(video.title)}</a></h3>
          <p class="meta">${safeText(video.channel)} â€¢ ${safeText(video.category)}</p>
        </div>
      </article>
    `;

    const videos = JSON.parse(document.getElementById('videos-data')?.textContent || '[]');
    const title = document.getElementById('categoryTitle');
    const target = document.getElementById('categoryVideos');

    const category = new URLSearchParams(window.location.search).get('k') || 'Semua';
    if (title) {
      title.textContent = `Kategori: ${category}`;
    }

    const filtered = videos.filter((video) => (category === 'Semua' ? true : video.category === category));

    if (target) {
      target.innerHTML = filtered.length
        ? filtered.map(videoCardHtml).join('')
        : '<p class="muted">Tiada video ditemui untuk kategori ini.</p>';
    }
  </script>
</BaseLayout>